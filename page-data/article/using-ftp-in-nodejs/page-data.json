{"componentChunkName":"component---src-templates-blog-post-js","path":"/article/using-ftp-in-nodejs/","result":{"data":{"site":{"siteMetadata":{"title":"DOPUTER","author":"김도현","siteUrl":"https://dohyeon.dev","comment":{"disqusShortName":"","utterances":"doputer/blog-comments"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"82530db4-0efc-5c7e-9228-c854dfbd190a","excerpt":"프로젝트를 하다가 FTP를 사용해서 내가 가진 게이트웨이에 파일을 보낼 일이 생겼다. FTP의 개념부터 클라이언트(NestJS)와 서버(ESL Gateway)를 연결하면서 내가 작업한 과정을 정리해보려고 한다. FTP 관련 프로토콜로 FTPS, SFTP가 있지만 여기서는  에 관해서만 다루려고 한다. FTP 란? 파일 전송 프로토콜(File Transfer Protocol, FTP)은 TCP/IP…","html":"<p>프로젝트를 하다가 FTP를 사용해서 내가 가진 게이트웨이에 파일을 보낼 일이 생겼다. FTP의 개념부터 클라이언트(NestJS)와 서버(ESL Gateway)를 연결하면서 내가 작업한 과정을 정리해보려고 한다.</p>\n<p>FTP 관련 프로토콜로 FTPS, SFTP가 있지만 여기서는 <code class=\"language-text\">FTP</code> 에 관해서만 다루려고 한다.</p>\n<h2 id=\"ftp-란\" style=\"position:relative;\"><a href=\"#ftp-%EB%9E%80\" aria-label=\"ftp 란 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FTP 란?</h2>\n<blockquote>\n<p>파일 전송 프로토콜(File Transfer Protocol, FTP)은 TCP/IP 프로토콜을 가지고 서버와 클라이언트 사이의 파일 전송을 하기 위한 프로토콜이다.</p>\n</blockquote>\n<p>예전에는 많이 사용한 프로토콜이지만, 지금은 보안상의 위험으로 많이 사용하지 않는다. FTPS나 SFTP로 대체된 것 같다.</p>\n<p>FTP는 두 가지 모드로 동작하는데 <code class=\"language-text\">Active Mode와 Passive Mode</code> 이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACCklEQVQ4y32Uh44rMQhF/f8fFaVKaVJ6b0rvvVd2DyuPnEneQ7I8ZjBwLxgjv7Lb7aTX60m329W1WCzk+XyKldfr9fG9Wq2k3+9799brteoNBtvtVpbLpcxmM12cH4+H58BdCME2m406xX46neqZO2Y4HKoCsU6IVq1W5Xg8yjexQa1zBNv5fC6mUqlo2u7Pw+Eg0WhUzueznk+nk4zHY80IaTQa3rfNGoelUkkMmUwmk7efOM5ms3K9XmU0GkkoFJJEIqE6HEUikQ+Hl8tF0um0mFarpUVw+UKCwaCSDTyyw4YsCFYulz3I1v52u0mxWBTTbDYV+7cM7dmtMsIdiuD+A02hUPjukD2VSmlbDAYDyWQyegY+mQDtvw5pGRcy1eYnvHAmYwpFN2ALHf90SMWoMpfv97sHCz7Q2VZypdPpeI1sO+PNIYuIZEDFgRYIBCSXy+mitdgpRrvdlng8/tGjOPaKYlsAJRnBUz6f132/32ulCQQSeCUYSaAnODsPBJ7VIQp/lYnmUuBKvV73INs7BKRX36rsDgTguYQzQCzMWq2mvckLAgF6AkCLOrSNjfDc4JNodgBANmdgYsuzpDB2qOAM/uldfXrJZFIN4YMdIxyQOcZ+6ECmjfxFAZWhaamcO22AGovFPuagpYQE7Pu3OqCHw+G/8eV/6DiGCjeAu/PG4dQ/HJgLPxSxVva4NpahAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ftp\"\n        title=\"ftp\"\n        src=\"/static/bafd0daff81ffc0ce067f110656a0656/c1b63/1.png\"\n        srcset=\"/static/bafd0daff81ffc0ce067f110656a0656/5a46d/1.png 300w,\n/static/bafd0daff81ffc0ce067f110656a0656/0a47e/1.png 600w,\n/static/bafd0daff81ffc0ce067f110656a0656/c1b63/1.png 1200w,\n/static/bafd0daff81ffc0ce067f110656a0656/b4904/1.png 1768w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>우선, Active Mode의 동작을 나타낸 그림인데 다음과 같은 순서로 동작한다.</p>\n<ol>\n<li>클라이언트가 서버의 21번 포트로 접속한 후, 클라이언트에서 사용할 포트를 알려준다.</li>\n<li>서버가 클라이언트의 요청에 응답한다.</li>\n<li>서버의 20번 포트가 클라이언트에서 알려준 포트로 접속한다.</li>\n<li>클라이언트가 서버의 요청에 응답한다.</li>\n</ol>\n<p>그림에서 볼 수 있듯이 <code class=\"language-text\">서버에서 클라이언트에 접속</code> 하는 구조이다.</p>\n<p>클라이언트에서 방화벽 등으로 외부 접속이 불가능한 상황이라면 접속이 불가능하고, 접속이 되더라도 정상적인 데이터 목록을 불러오지 못 할 수도 있다. 클라이언트는 방화벽 인바운드 허용, 서버는 방화벽 아웃바운드 허용을 통해서 해결해야 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACFUlEQVQ4y5WUV6vjQAyF/f//UJ5COiE9pHfSe+9du59AxrvJw70C45mxdHR0pLEjf22/30u/35der6fPcrmU1+slZu/3+2O9Xq9lMBi4cZvNRs8dHHa7naxWK1ksFjKfz3X/fD5dAO+DkWy73Soo/rPZTPfEOKPRSA+w6/WqQWSr1WpyOp3km1lSA8fwhZBTrVaVNjYejxWUj9FoVNfY8XjUpFZWs9lUdl4JiCmXy+LAZDKZ6GE+n9dgW5/PZ90nk0kJhUKqGfpGIpEPQJKn02lx2u22loBxcDgcdB0IBJQ5DQMEjQmixEql4pZsgPf7XUqlkjitVssF5MB0g+HtdlOG0+lU0Ppyueg3YmiCFxDfYrH4L2ChUHABYVuv1yWRSEgqldJ9NptVnXn/GpCPOFknYQdTykdPa5B1mZH5CmhNoXzvcHut0Wi4Whs7moRMHxraqLCmLDoLQC6X07GgIT6fT6yZTAiseSOFAtpgo1On09G93+8XZhQwdKNcAGAGMF3HHo+HW7rbZQNEfIKNofcOe41m/agpaAB9G2a70zQARjY23BTm02suIB+NIToNh0MVOBaLuRqhWyaT0fJJhlb4MRE2CQy2AqIZrDACzYHg/0tmz3UEnFtEBZAhMTLE43FxKBNQLBgMqhMCM2tk9f7CbIwA5M/i1RAJwuGwOFC3jqEnOuHEWHz7J2LdbtfV0NsUYv4Am2BOILMLXDIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ftp\"\n        title=\"ftp\"\n        src=\"/static/2971d38d3d178b0cd23f57abbc193d63/c1b63/2.png\"\n        srcset=\"/static/2971d38d3d178b0cd23f57abbc193d63/5a46d/2.png 300w,\n/static/2971d38d3d178b0cd23f57abbc193d63/0a47e/2.png 600w,\n/static/2971d38d3d178b0cd23f57abbc193d63/c1b63/2.png 1200w,\n/static/2971d38d3d178b0cd23f57abbc193d63/a2498/2.png 1764w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>다음은 Passive Mode의 동작을 나타낸 그림인데 다음과 같은 순서로 동작한다.</p>\n<ol>\n<li>클라이언트가 서버의 21번 포트로 Passive 접속을 시도한다.</li>\n<li>서버에서 사용할 포트를 클라이언트에 알려준다.</li>\n<li>클라이언트는 서버에서 알려준 포트로 접속을 시도한다.</li>\n<li>서버가 클라이언트의 요청에 응답한다.</li>\n</ol>\n<p>위에서 언급한 Active Mode와는 반대로 <code class=\"language-text\">클라이언트에서 서버에 접속</code> 하는 구조이다.</p>\n<p>서버의 데이터 포트가 막혀 있는 경우 연결이 불가능하다. 데이터 포트의 범위는 별도로 지정하지 않는 경우 1024 ~ 65535번 포트를 사용하기 때문에 방화벽 인바운드를 모두 열어놔야 하는데, 데이터 포트의 범위를 지정해놓으면 이러한 문제를 어느 정도 해결할 수 있다고 한다.</p>\n<h2 id=\"ftp-client-nestjs\" style=\"position:relative;\"><a href=\"#ftp-client-nestjs\" aria-label=\"ftp client nestjs permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FTP Client (NestJS)</h2>\n<p>프로젝트에서 서버 스택은 <code class=\"language-text\">NestJS</code> 를 사용했는데 일정 시간 마다 ESL Gateway에 csv 파일을 FTP 통신을 통해서 보내야했다. 일정 시간 간격으로 보내기 위해서 Cron을 사용했는데 이것과 관련된 내용은 다른 글에서 다루기로 하고 이번에는 FTP 연결에 초점을 맞추려고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// task.module.ts</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FtpModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'nestjs-ftp'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    FtpModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRootFtpAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      inject<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigService<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>configService<span class=\"token operator\">:</span> ConfigService<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          host<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FTP_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          port<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">getNumber</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FTP_PORT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          user<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FTP_USER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          password<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FTP_PASSWORD'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          secure<span class=\"token operator\">:</span> configService<span class=\"token punctuation\">.</span><span class=\"token function\">getBoolean</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FTP_SECURE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>내가 이용한 패키지는 <code class=\"language-text\">nestjs-ftp</code> 이다.</p>\n<p>코드 상에서는 <code class=\"language-text\">.env</code> 환경 변수에서 설정 값을 읽어올 수 있도록 직접 구현한 ConfigService를 이용했지만 직접 입력해놔도 된다. 이렇게 클라이언트 설정이 끝나면 서비스 코드에서 파일을 보내주는 작업을 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// task.service.ts</span>\n\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ftpService<span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>originPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>file<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>destinationPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>file<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>code <span class=\"token operator\">===</span> <span class=\"token number\">226</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggerService<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ftp success'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>code <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggerService<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ftp failed'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">else</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loggerService<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ftp unknown response'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">unlinkSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>originPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>file<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우선 전송할 파일을 생성해준다. 이후 <code class=\"language-text\">upload(origin, destination)</code> 를 이용해서 생성한 파일을 보내준다. <code class=\"language-text\">nestjs-ftp</code> 는 응답으로 code와 message가 도착하는데 직접 테스트 해보니 226이 오면 전송 성공, 0이 오면 전송 실패였다. 다른 코드가 오는 경우를 대비해서 예외 처리를 한번 더 해줬다. 마지막으로 finally 문에서 생성한 파일을 삭제해줬다.</p>\n<p>클라이언트 설정(연결)만 제대로 되면 큰 문제 없이 FTP를 통해서 파일을 전송할 수 있다.</p>\n<h2 id=\"ftp-server-esl-gateway\" style=\"position:relative;\"><a href=\"#ftp-server-esl-gateway\" aria-label=\"ftp server esl gateway permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FTP Server (ESL Gateway)</h2>\n<p>ESL Gateway는 내가 직접 만든 것은 아니고 FTP 포트 설정이 되어있는 게이트웨이이다. 다만, 외부에서 접속하기 때문에 공유기 포트 포워딩 설정을 해줬다.</p>\n<p>내가 사용 중인 공유기는 ipTIME 이고, 포트 포워딩 설정은 다른 공유기들도 비슷할거라고 생각한다.</p>\n<p><code class=\"language-text\">ipTime 관리도구 -> 고급 설정 -> NAT/라우터 관리 -> 포트포워드 설정</code> 순으로 들어가준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 647px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAArUlEQVQY0z2PWQ6AIBBDuf+tvIKKKEQl7guo4QI1nUQ/3sdsbUfN8wyyLAvO88R93z/jOCKEgJSScF0X9n1H3/domkZm3DuOA13X4XkeqLquURSFHK/rKgcU37ZNesYYWGtFgDOack4+QYplWQZnHRSLtm1FjHCJCUiMEcMwSN85JwZMw5pCTExYc58migdVVQlsaq1RlqW45nn+pyMxRDGhCD/w3mOaJvDLL9gLWP8k94Da6E8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ftp\"\n        title=\"ftp\"\n        src=\"/static/5ba07787602dbcc2cfdaaee86b2f57dd/ca12d/3.png\"\n        srcset=\"/static/5ba07787602dbcc2cfdaaee86b2f57dd/5a46d/3.png 300w,\n/static/5ba07787602dbcc2cfdaaee86b2f57dd/0a47e/3.png 600w,\n/static/5ba07787602dbcc2cfdaaee86b2f57dd/ca12d/3.png 647w\"\n        sizes=\"(max-width: 647px) 100vw, 647px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>이후 <code class=\"language-text\">새규칙 추가</code> 를 통해서 외부 포트를 설정하고 FTP Server에 해당하는 내부 IP주소와 내부 포트를 설정해주면 된다.</p>\n<h2 id=\"ftp-server가-비정규-포트를-사용하는-경우\" style=\"position:relative;\"><a href=\"#ftp-server%EA%B0%80-%EB%B9%84%EC%A0%95%EA%B7%9C-%ED%8F%AC%ED%8A%B8%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\" aria-label=\"ftp server가 비정규 포트를 사용하는 경우 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FTP Server가 비정규 포트를 사용하는 경우</h2>\n<p>일반적으로 위 과정까지 마무리하면 접속과 파일 송수신이 원활하게 이루어진다. 다만, 나는 ESL Gateway를 받았을 때 FTP 포트 설정이 21번 정규 포트가 아니라 다른 포트를 사용하는 비정규 포트로 되어있었다. 위에서 설명한 것처럼 FTP 통신 시에 21번 포트는 <code class=\"language-text\">Command</code> 포트이고, 20번 포트는 <code class=\"language-text\">Data</code> 포트이다. 정해진 규약이기 때문에 일반적으로 공유기나 방화벽에서 21번 포트를 열면 20번 포트도 같이 열리게 된다.</p>\n<p>하지만 비정규 포트를 사용하는 경우에는 <code class=\"language-text\">FTP 연결이 되어도 디렉토리와 파일 목록이 보이지 않거나 데이터를 전송할 수 없다.</code> 이를 해결하기 위해서 공유기에서 추가 작업을 해줘야한다.</p>\n<p><code class=\"language-text\">ipTime 관리도구 -> 고급 설정 -> NAT/라우터 관리 -> 고급 NAT 설정 -> FTP 비정규 포트</code> 순으로 들어가준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 548px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAeklEQVQI142NSQpEIQxEvf/ZBFFwIaK0CN95uEE1Eb70shdFKkPlsRgjhBDgnCN8AvbemHNijHFE/h/13k9l3ntYa++AntRaYYyBc+4AaEd6Ib+iTCkFSimklMBCCNBa43kerLXu0QtqrV1Iq+305AmQcz4Z6qWU58cXzAbe1BynYJcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ftp\"\n        title=\"ftp\"\n        src=\"/static/75aa8f125aba50dcc7e8556db6d0f523/a58fe/4.png\"\n        srcset=\"/static/75aa8f125aba50dcc7e8556db6d0f523/5a46d/4.png 300w,\n/static/75aa8f125aba50dcc7e8556db6d0f523/a58fe/4.png 548w\"\n        sizes=\"(max-width: 548px) 100vw, 548px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>이후 이미지처럼 사용하기를 원하는 비정규 포트를 추가해주면 정상적으로 사용이 가능하다.</p>","tableOfContents":"<ul>\n<li><a href=\"/article/using-ftp-in-nodejs/#ftp-%EB%9E%80\">FTP 란?</a></li>\n<li><a href=\"/article/using-ftp-in-nodejs/#ftp-client-nestjs\">FTP Client (NestJS)</a></li>\n<li><a href=\"/article/using-ftp-in-nodejs/#ftp-server-esl-gateway\">FTP Server (ESL Gateway)</a></li>\n<li><a href=\"/article/using-ftp-in-nodejs/#ftp-server%EA%B0%80-%EB%B9%84%EC%A0%95%EA%B7%9C-%ED%8F%AC%ED%8A%B8%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\">FTP Server가 비정규 포트를 사용하는 경우</a></li>\n</ul>","frontmatter":{"title":"NestJS에서 FTP 사용하기 📦"}}},"pageContext":{"slug":"/article/using-ftp-in-nodejs/","previous":{"fields":{"slug":"/article/running-service-with-pm2/"},"frontmatter":{"title":"PM2로 서비스 운영하기 🚙"}},"next":null}}}