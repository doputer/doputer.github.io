---
emoji: 'ğŸ“'
title: 'ë§ˆí¬ë‹¤ìš´ ì—ë””í„° ì œì‘ê¸°'
description: 'ë§ˆí¬ë‹¤ìš´ ì—ë””í„° ì œì‘ê¸°ë¥¼ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ì¨ë³´ê² ìŠµë‹ˆë‹¤'
tags:
  - react
  - editor
date: 2022-12-21
---

## ê¸€ì˜ ê°€ì¹˜ë¥¼ ì˜¬ë ¤ì£¼ëŠ” ì—ë””í„°

[Knoticle](https://github.com/boostcampwm-2022/web01-knoticle) ì„œë¹„ìŠ¤ì—ì„œ ê¸€ ì‘ì„± í™˜ê²½ì€ ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤. ì‚¬ìš©ìë“¤ì´ ê¸€ì„ í¸ì§‘í•˜ê³  ê³µìœ í•˜ê¸° ìœ„í•´ì„œëŠ” í…ìŠ¤íŠ¸ë¿ ì•„ë‹ˆë¼ ì´ë¯¸ì§€ ì²¨ë¶€ë‚˜ ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ì„ ì§€ì›í•˜ëŠ” ì—ë””í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ì´ë²ˆ ê¸€ì—ì„œëŠ” ì´ëŸ° ìš”êµ¬ë¥¼ ì¶©ì¡±í•˜ê¸° ìœ„í•´ ë§ˆí¬ë‹¤ìš´ ì—ë””í„°ë¥¼ ê°œë°œí•œ ê³¼ì •ì„ ì†Œê°œí•©ë‹ˆë‹¤.

![](0.png)

## CodeMirror ì—ë””í„° í™œìš©í•˜ê¸°

> ì½”ë“œë¯¸ëŸ¬(CodeMirror)ëŠ” ë¸Œë¼ìš°ì €ì— ì½”ë“œ í¸ì§‘ê¸°ë¥¼ ì œê³µí•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ êµ¬ì„± ìš”ì†Œì´ë‹¤. í’ë¶€í•œ í”„ë¡œê·¸ë˜ë° APIë¥¼ ë³´ìœ í•˜ê³  ìˆìœ¼ë©° í™•ì¥ì„±ì— ì´ˆì ì„ ë‘”ë‹¤.

[CodeMirror](https://codemirror.net/)ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì½”ë“œ í¸ì§‘ê¸°ë¥¼ ì œê³µí•˜ëŠ” JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‹¤ì–‘í•œ í™•ì¥ ê¸°ëŠ¥ì„ ì†ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì—ë””í„°ë¥¼ í™œìš©í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

- ë§ˆí¬ë‹¤ìš´ êµ¬ë¬¸ ê°•ì¡°
- ì—ë””í„° í…Œë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- ë‹¨ì¶•í‚¤ ì„¤ì •
- ì»¤ì„œ ìœ„ì¹˜ í™•ì¸

ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì„ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í›…ìœ¼ë¡œ ë§Œë“¤ì–´ ê¸€ì“°ê¸° í˜ì´ì§€ ì™¸ì—ë„ ëŒ“ê¸€ ê¸°ëŠ¥ ë“±ì—ì„œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```tsx useCodeMirror.tsx
import { useCallback, useEffect, useState } from 'react';

import { markdown, markdownLanguage } from '@codemirror/lang-markdown';
import { languages } from '@codemirror/language-data';
import { EditorState } from '@codemirror/state';
import { EditorView } from 'codemirror';

export default function useCodeMirror() {
  const [element, setElement] = useState<HTMLElement>();

  const ref = useCallback((node: HTMLElement | null) => {
    if (!node) return;

    setElement(node);
  }, []);

  useEffect(() => {
    if (!element) return;

    const editorState = EditorState.create({
      extensions: [
        markdown({
          base: markdownLanguage,
          codeLanguages: languages,
        }),
      ],
    });

    const view = new EditorView({
      state: editorState,
      parent: element,
    });

    return () => view?.destroy();
  }, [element]);

  return {
    ref,
  };
}
```

ì´ì œ ì—¬ê¸°ì— ì—¬ëŸ¬ ê°€ì§€ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ì„œ ì„œë¹„ìŠ¤ì— ë§ëŠ” ì—ë””í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì´ë¯¸ì§€ ì²¨ë¶€í•˜ê¸°

í…ìŠ¤íŠ¸ë§Œìœ¼ë¡œëŠ” í•œê³„ê°€ ìˆì„ ë•Œ ì´ë¯¸ì§€ê°€ ìœ ìš©í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•  ìˆ˜ ìˆë„ë¡ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

- íŒŒì¼ì—ì„œ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°
- ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ì²¨ë¶€í•˜ê¸°
- ì²¨ë¶€ ë²„íŠ¼ì„ í†µí•´ ì„ íƒí•˜ê¸°

ìœ„ ê³¼ì •ì€ **ì´ë²¤íŠ¸ ê°ì§€(ë¶™ì—¬ë„£ê¸°, ë“œë¡­, ë²„íŠ¼ í´ë¦­) â†’ Knoticle API ì„œë²„ì— ì´ë¯¸ì§€ ì €ì¥ ìš”ì²­ â†’ ë°˜í™˜ëœ ì´ë¯¸ì§€ URLì„ ì—ë””í„°ì— ì‚½ì…**ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

### ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°

ì½”ë“œë¯¸ëŸ¬ ìµìŠ¤í…ì…˜ì— ì¶”ê°€í•  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‘ì„±í•´ì¤ë‹ˆë‹¤.

```tsx useCodeMirror.tsx
const eventHandler = () => { ... }

const editorState = EditorState.create({
  extensions: [
    ...,
    eventHandler(),
	]
})
```

ì½”ë“œë¯¸ëŸ¬ì˜ `domEventHandlers`ë¥¼ í™œìš©í•´ì„œ ë¶™ì—¬ë„£ê¸° ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—ë””í„°ì— í¬ì»¤ìŠ¤ê°€ ìœ„ì¹˜í•œ ìƒíƒœì—ì„œ ë¶™ì—¬ë„£ê¸° ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ `clipboardData`ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”ë° ì´ ë°ì´í„°ê°€ ì´ë¯¸ì§€ íŒŒì¼ì¸ì§€ ê²€ì‚¬í•´ì„œ ì„œë²„ì— ì „ì†¡í•©ë‹ˆë‹¤. ì„œë²„ì—ì„œëŠ” ì´ë¯¸ì§€ íŒŒì¼ì„ `Object Storage`ì— ì €ì¥í•˜ê³ , ì €ì¥ëœ `URL`ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

```tsx useCodeMirror.tsx
const handleImage = (imageFile: File) => {
  if (!/image\/[png,jpg,jpeg,gif]/.test(imageFile.type)) return;

  const formData = new FormData();

  formData.append('image', imageFile);

  createImage(formData); // Knoticle API ì„œë²„ì— ìš”ì²­
};

const eventHandler = () => {
  return EditorView.domEventHandlers({
    paste(event) {
      if (!event.clipboardData) return;

      const { items } = event.clipboardData;

      for (const item of items) {
        if (!(item.kind === 'file')) return;
        handleImage(item.getAsFile() as File);
      }
    },
  });
};
```

ì €ì¥ëœ URLì„ ë°˜í™˜ë°›ì•˜ë‹¤ë©´ ë§ˆí¬ë‹¤ìš´ ì´ë¯¸ì§€ ë¬¸ë²•ì¸ `![image](path)` í˜•ì‹ìœ¼ë¡œ ì—ë””í„°ì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë•Œ ìì—°ìŠ¤ëŸ¬ìš´ UXë¥¼ ìœ„í•´ì„œ ë¶™ì—¬ë„£ì€ ì»¤ì„œì˜ ìœ„ì¹˜ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```tsx useCodeMirror.tsx
const insertCursor = (text: string) => {
  if (!editorView) return;

  editorView.focus();

  // ì•„ë˜ì™€ ê°™ì´ ì—ë””í„°ì˜ í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  const cursor = editorView.state.selection.main.head;

  editorView.dispatch({
    changes: { from: cursor, to: cursor, insert: text },
    selection: { anchor: cursor + text.length },
  });
};

useEffect(() => {
  if (!editorView) return;

  const markdownImage = (path: string) => `![image](${path})`;
  const text = markdownImage(image?.imagePath);

  insertCursor(text);
}, [image]);
```

![](1.gif)

### ì´ë¯¸ì§€ ë“œë˜ê·¸ ì•¤ ë“œë¡­

ì´ ë°©ë²•ì€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë§Œ ì¶”ê°€í•´ì£¼ë©´ ìœ„ì—ì„œ ì‘ì„±í•œ ì½”ë“œë“¤ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ì„œ ì‘ì„±í•œ ì½”ë“œë“¤ì€ ì¬ì‚¬ìš©ì´ ìš©ì´í•˜ë„ë¡ í•¨ìˆ˜ë§ˆë‹¤ í•˜ë‚˜ì˜ ì±…ì„ë§Œ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì´ë¯¸ì§€ë¥¼ ë“œë¡­í•  ë•Œ ë§ˆìš°ìŠ¤ ì»¤ì„œì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ê³³ì— ì´ë¯¸ì§€ê°€ ì²¨ë¶€ë  ìˆ˜ ìˆë„ë¡ ì—ë””í„° ì»¤ì„œì˜ ìœ„ì¹˜ë¥¼ ì¡°ì •í•´ì¤ë‹ˆë‹¤. ì½”ë“œë¯¸ëŸ¬ì˜ `posAtCoords` ë©”ì„œë“œë¡œ í˜„ì¬ ë§ˆìš°ìŠ¤ ì»¤ì„œì™€ ê°€ì¥ ê°€ê¹Œìš´ ì—ë””í„° ì»¤ì„œì˜ ìœ„ì¹˜ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx useCodeMirror.tsx
const eventHandler = () => {
  return EditorView.domEventHandlers({
    ...,
    drop(event, view) {
      if (!event.dataTransfer) return;

      const cursorPos = view.posAtCoords({ x: event.clientX, y: event.clientY });

      if (cursorPos) view.dispatch({ selection: { anchor: cursorPos, head: cursorPos } });

      const { files } = event.dataTransfer;

      for (const file of files) handleImage(file);
    },
  });
};
```

![](2.gif)

### ì´ë¯¸ì§€ ì²¨ë¶€ ë²„íŠ¼ í´ë¦­

ì´ ë°©ë²•ì€ input íƒœê·¸ë¥¼ í†µí•´ ì´ë¯¸ì§€ íŒŒì¼ì„ ë°›ì•„ì˜¤ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì½”ë“œë¯¸ëŸ¬ ìµìŠ¤í…ì…˜ì„ ì´ìš©í•˜ì§€ ì•Šê³ , ì§ì ‘ HTML íƒœê·¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ì´í›„ì—ëŠ” ì•ì„œ ì‘ì„±í•œ í•¨ìˆ˜ë“¤ì„ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.

```tsx Editor/index.tsx
<input
  id="image"
  type="file"
  accept="image/png,image/jpg,image/jpeg,image/gif"
  onChange={(event) => {
    if (event.target.files) handleImage(event.target.files[0]);
  }}
/>
```

![](3.gif)

## ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ ë²„íŠ¼ ì¶”ê°€í•˜ê¸°

ë§ˆí¬ë‹¤ìš´ì—ì„œëŠ” ì—¬ëŸ¬ê°€ì§€ ë¬¸ë²•ì„ ì´ìš©í•´ì„œ í…ìŠ¤íŠ¸ë¥¼ í’ë¶€í•˜ê²Œ ê¾¸ë©°ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ë¸”ë¡ ìŠ¤íƒ€ì¼: h1(#), h2(##), h3(###) ë“±
- ì¸ë¼ì¸ ìŠ¤íƒ€ì¼: bold(\*\*), italic(\_), quote(`) ë“±

ì´ëŸ° ìŠ¤íƒ€ì¼ë“¤ì€ ì§ì ‘ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ, í¸ì˜ì„±ì„ ìœ„í•´ ë²„íŠ¼ í´ë¦­ë§Œìœ¼ë¡œ ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ë„ë¡ ì œê³µí•©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•´ì„  í˜„ì¬ ì—ë””í„° ì»¤ì„œì˜ ìœ„ì¹˜ì™€ ì»¤ì„œê°€ ìœ„ì¹˜í•œ ê³³ì˜ ë¬¸ìì—´ì„ íŒŒì‹±í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ì™€ ê´€ë ¨ëœ í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ê³ , ì»¤ìŠ¤í…€ ë²„íŠ¼ë“¤ì„ ë‚˜ì—´í•´ì„œ ê°ê°ì˜ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— ì—°ê²° ì‹œì¼œì¤ë‹ˆë‹¤.

### ë¸”ë¡ ìŠ¤íƒ€ì¼

ë¸”ë¡ ìŠ¤íƒ€ì¼ì€ í˜„ì¬ ì»¤ì„œê°€ ìœ„ì¹˜í•œ ë¼ì¸ì— ë¸”ë¡ ìŠ¤íƒ€ì¼ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì´ ì ìš©ëëŠ”ì§€ í™•ì¸í•´ì•¼í•©ë‹ˆë‹¤. ë¼ì¸ì— ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ì–´ìˆìœ¼ë©´ í•´ì œí•˜ê³ , í•´ì œë˜ì–´ ìˆìœ¼ë©´ ì ìš©ì‹œì¼œì£¼ë„ë¡ í† ê¸€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.

ì½”ë“œë¯¸ëŸ¬ì—ì„œ ì œê³µí•˜ëŠ” `lineAt` ë©”ì„œë“œë¡œ í˜„ì¬ ì»¤ì„œê°€ ìœ„ì¹˜í•œ ë¼ì¸ì˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx useCodeMirror.tsx
// symbol -> '# ', '## ', '### ' ë“±
const insertStartToggle = (symbol: string) => {
  if (!editorView) return;

  editorView.focus();

  const { head } = editorView.state.selection.main;
  const { from, to, text } = editorView.state.doc.lineAt(head);

  const hasExist = text.startsWith(symbol);

  if (!hasExist) {
    editorView.dispatch({
      changes: {
        from,
        to,
        insert: `${symbol}${text}`,
      },
      selection: {
        anchor: from + text.length + symbol.length,
      },
    });

    return;
  }

  editorView.dispatch({
    changes: {
      from,
      to,
      insert: `${text.slice(symbol.length, text.length)}`,
    },
  });
};
```

![](4.gif)

### ì¸ë¼ì¸ ìŠ¤íƒ€ì¼

ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ì€ í˜„ì¬ ì—ë””í„°ì—ì„œ ì„ íƒëœ í…ìŠ¤íŠ¸ì— ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì´ ì ìš©ëëŠ”ì§€ í™•ì¸í•´ì•¼í•©ë‹ˆë‹¤. ë¸”ë¡ ìŠ¤íƒ€ì¼ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í† ê¸€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.

ì½”ë“œë¯¸ëŸ¬ì—ì„œ ì œê³µí•˜ëŠ” `sliceDoc` ë©”ì„œë“œë¡œ ì—ë””í„°ì— ì‘ì„±ëœ í…ìŠ¤íŠ¸ ì¼ë¶€ë¥¼ ì˜ë¼ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„ íƒëœ í…ìŠ¤íŠ¸ ì–‘ìª½ì— ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì´ ì ìš©ëëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

ë§Œì•½ ì„ íƒëœ í…ìŠ¤íŠ¸ê°€ ì—†ë‹¤ë©´ `defaultText`ì™€ í•¨ê»˜ ì„ íƒí•œ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì ìš©í•´ì„œ ì—ë””í„°ì— í‘œì‹œí•´ì¤ë‹ˆë‹¤.

```tsx useCodeMirror.tsx
// symbol -> '**', '_', '`' ë“±
const insertBetweenToggle = (symbol: string, defaultText = 'í…ìŠ¤íŠ¸') => {
  if (!editorView) return;

  editorView.focus();

  const { from, to } = editorView.state.selection.ranges[0];

  const text = editorView.state.sliceDoc(from, to);

  const prefixText = editorView.state.sliceDoc(from - symbol.length, from);
  const affixText = editorView.state.sliceDoc(to, to + symbol.length);

  const hasExist = symbol === prefixText && symbol === affixText;

  if (!hasExist) {
    editorView.dispatch({
      changes: {
        from,
        to,
        insert: `${symbol}${text || defaultText}${symbol}`,
      },
      selection: {
        head: from + symbol.length,
        anchor: text ? to + symbol.length : to + symbol.length + defaultText.length,
      },
    });

    return;
  }

  editorView.dispatch({
    changes: {
      from: from - symbol.length,
      to: to + symbol.length,
      insert: text,
    },
    selection: {
      head: from - symbol.length,
      anchor: to - symbol.length,
    },
  });
};
```

![](5.gif)
