---
emoji: 'ğŸ»'
title: 'Zustandì˜ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë§‰ê¸°'
description: 'ì˜ë„í•œëŒ€ë¡œ ë Œë”ë§ í•´ë´…ì‹œë‹¤'
tags:
  - react
  - zustand
date: 2024-11-14
---

## Zustandì™€ ë¦¬ë Œë”ë§

ì•„ë˜ì™€ ê°™ì´ Zustand ìŠ¤í† ì–´ì™€ ë‘ ê°œì˜ ì»´í¬ë„ŒíŠ¸ê°€ ìˆìŠµë‹ˆë‹¤.

```tsx
interface Store {
  a: number;
  b: number;
  increaseA: () => void;
}

const useStore = create<Store>((set) => ({
  a: 0,
  b: 0,
  increaseA: () => set((state) => ({ a: state.a + 1 })),
}));
```

```tsx
function Foo() {
  const a = useStore((state) => state.a);
  const increaseA = useStore((state) => state.increaseA);

  return (
    <>
      <span>A: {a}</span>
      <button onClick={increaseA}>Increase A</button>
    </>
  );
}

function Bar() {
  const b = useStore((state) => state.b);

  return (
    <>
      <span>B: {b}</span>
    </>
  );
}
```

`Foo` ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ë³€ê²½í•´ë„ `Bar` ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `Bar` ì»´í¬ë„ŒíŠ¸ê°€ ìŠ¤í† ì–´ì—ì„œ ê°€ì ¸ì˜¤ëŠ” [ì›ì‹œ ê°’](https://developer.mozilla.org/ko/docs/Glossary/Primitive)ì´ ë³€ê²½ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì´ë²ˆì—ëŠ” `Bar` ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì„ ìˆ˜ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```tsx
function Bar() {
  const { b } = useStore((state) => state);

  return (
    <>
      <span>B: {b}</span>
    </>
  );
}
```

`Foo` ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ë³€ê²½í•˜ë©´ `Bar` ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚©ë‹ˆë‹¤. `Bar` ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” `a`ë¼ëŠ” ê°’ë§Œ ë³€ê²½ë˜ì—ˆëŠ”ë° ë§ì´ì£ . ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ ì˜ë„í•˜ì§€ ì•Šì€ ê²°ê³¼ì…ë‹ˆë‹¤.

ì›ì¸ì€ `Foo` ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒíƒœë¥¼ ë³€ê²½í•  ë•Œ ê°ì²´ì˜ ì°¸ì¡°ê°€ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ZustandëŠ” selectorì—ì„œ ì‹¤í–‰ëœ ê°’ì„ [Object.is](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is?retiredLocale=it)ë¡œ ë¹„êµí•˜ê³  ë³€ê²½ë˜ì—ˆì„ ê²½ìš° ë¦¬ë Œë”ë§ í•©ë‹ˆë‹¤. ìœ„ ì½”ë“œëŠ” ì‹¤ì œë¡œ ìŠ¤í† ì–´ì˜ ê°ì²´ ì „ì²´ë¥¼ êµ¬ë…í•˜ê³  ìˆëŠ” ì…ˆì…ë‹ˆë‹¤.

> ZustandëŠ” Reactì˜ `useState`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ìƒíƒœë¥¼ ë¶ˆë³€í•˜ê²Œ ì—…ë°ì´íŠ¸ í•´ì•¼ í•©ë‹ˆë‹¤.
>
> ë‚´ë¶€ì ìœ¼ë¡œ ìƒíƒœë¥¼ ë³‘í•©í•˜ê¸° ë•Œë¬¸ì— `...state`ì™€ ê°™ì€ ì „ê°œ êµ¬ë¬¸ì„ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>
> ì•„ë˜ ë‘ ì½”ë“œëŠ” ë™ì¼í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.
>
> ```tsx
> set((state) => ({ a: state.a + 1 }));
> set((state) => ({ ...state, a: state.a + 1 }));
> ```
>
> [Immutable state and merging](https://zustand.docs.pmnd.rs/guides/immutable-state-and-merging)

## ê°ì²´ì—ì„œ ê°’ êµ¬ë…í•˜ê¸°

ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ìœ ë°œí•˜ì§€ ì•Šê³ , ê°ì²´ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. ê°ì²´ ì „ì²´ë¥¼ êµ¬ë…í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì»´í¬ë„ŒíŠ¸ì—ì„œ í•„ìš”í•œ ê°’ë§Œ êµ¬ë…í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

```tsx
// Good ğŸ‘
const a = useStore((state) => state.a);

// Bad ğŸ‘
const { a } = useStore((state) => state);
```

ê·¸ëŸ°ë° ê°ì²´ì—ì„œ êµ¬ë…í•´ì•¼ í•˜ëŠ” ê°’ì´ ë§ì•„ì§€ë©´ ì½”ë“œ ê°€ë…ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.

ì´ëŸ° ê²½ìš° Zustandì—ì„œ ì œê³µí•˜ëŠ” [useShallow](https://zustand.docs.pmnd.rs/guides/prevent-rerenders-with-use-shallow)ë¼ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// Hmm ğŸ¤”
const a = useStore((state) => state.a);
const b = useStore((state) => state.b);
const c = useStore((state) => state.c);

// Oh ğŸ˜†
// fold[55:88]
const { a, b, c } = useStore(useShallow((state) => ({ a: state.a, b: state.b, c: state.c })));
```

ì•ì„œ ZustandëŠ” `Object.is`ë¥¼ í†µí•´ selectorì—ì„œ ì‹¤í–‰ëœ ê°’ì„ ë¹„êµí•´ì„œ ë¦¬ë Œë”ë§ ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. `useShallow`ë¥¼ ì´ìš©í•˜ë©´ ì‹¤í–‰ëœ ê°’ì´ ì´ì „ê³¼ ê°™ìœ¼ë©´ ë¦¬ë Œë”ë§í•˜ì§€ ì•Šë„ë¡ ë§‰ì•„ì¤ë‹ˆë‹¤.

## useShallowì˜ ë™ì‘ ì›ë¦¬

ê·¸ë ‡ë‹¤ë©´ `useShallow`ëŠ” ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë™ì‘í• ê¹Œìš”?

ì•„ë˜ëŠ” Zustandì˜ [useShallow](https://github.com/pmndrs/zustand/blob/main/src/react/shallow.ts) êµ¬í˜„ ì½”ë“œì…ë‹ˆë‹¤.

```react/shallow.ts
import React from 'react';
import { shallow } from '../vanilla/shallow.ts';

export function useShallow<S, U>(selector: (state: S) => U): (state: S) => U {
  const prev = React.useRef<U>();
  return (state) => {
    const next = selector(state);
    return shallow(prev.current, next) ? (prev.current as U) : (prev.current = next);
  };
}
```

ì½”ë“œë¥¼ í•œ ì¤„ì”© ë³´ê² ìŠµë‹ˆë‹¤.

`prev`ëŠ” ì´ì „ ê°’ì„ ì €ì¥í•˜ê³ , ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ `useRef`ë¡œ ì„ ì–¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ì—ì„œ ë¦¬ë Œë”ë§ì„ í”¼í•˜ë©´ì„œ ì´ì „ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•œ ê±¸ë¡œ ë³´ì…ë‹ˆë‹¤.

useShallowì—ì„œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ `(state) => { ... }`ëŠ” useShallowê°€ í˜¸ì¶œë  ë•Œì˜ `prev`ì™€ `selector`ë¥¼ ì°¸ì¡°í•˜ëŠ” [í´ë¡œì €](https://developer.mozilla.org/ko/docs/Web/JavaScript/Closures)ì…ë‹ˆë‹¤. í´ë¡œì €ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ useShallow í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ prevê°€ ìƒˆë¡­ê²Œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì´ì „ ê°’ì„ ìœ ì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë¥¼ ë§‰ê¸° ìœ„í•´ì„œ í´ë¡œì €ë¡œ ì°¸ì¡°í•´ì„œ ë™ì¼í•œ prev ê°ì²´ë¥¼ ì°¸ì¡°í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

`(state) => { ... }` ë‚´ë¶€ì—ì„œëŠ” ê°±ì‹ ëœ ìƒíƒœë¥¼ selectorë¥¼ í†µí•´ì„œ nextì— ì €ì¥í•©ë‹ˆë‹¤. ì´í›„ `shallow` í•¨ìˆ˜ë¥¼ í†µí•´ `prev`ì™€ `next`ë¥¼ ë¹„êµí•´ì„œ ê°’ì´ ê°™ë‹¤ë©´ ê¸°ì¡´ ê°’ì„ ë°˜í™˜í•˜ê³ , ë‹¤ë¥´ë‹¤ë©´ `prev`ì— `next`ë¥¼ ì €ì¥í•˜ê³  ì €ì¥ëœ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

ë§Œì•½ ë¹„êµí•œ ê°’ì´ ê°™ì•„ì„œ `prev`ë¥¼ ë°˜í™˜í–ˆë‹¤ë©´ ê¸°ì¡´ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•œ ê²ƒì´ê¸° ë•Œë¬¸ì— ì´ë¥¼ êµ¬ë…í•˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

> ì´ ë¶€ë¶„ì—ì„œ **ê°’ì„ ë¹„êµí•œë‹¤**ë¼ëŠ” í‘œí˜„ì€ ì•ì„  `Object.is`ì™€ ë‹¤ë¦…ë‹ˆë‹¤.
>
> ZustandëŠ” ìì²´ êµ¬í˜„í•œ [shallow](https://github.com/pmndrs/zustand/blob/main/src/vanilla/shallow.ts) í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ë¹„êµ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ”ë°ìš”. ë‹¨ìˆœíˆ ê°ì²´ì˜ ì°¸ì¡°ë§Œ ë¹„êµí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°ì²´ì˜ ì²« ë²ˆì§¸ ê¹Šì´ê¹Œì§€ í‚¤-ê°’ìŒì´ë‚˜ ìš”ì†Œë¥¼ ìˆœíšŒí•˜ë©´ì„œ ë¹„êµí•©ë‹ˆë‹¤.
