---
emoji: 'ğŸ–¼ï¸'
title: 'Next.js MDX ì´ë¯¸ì§€ ê²½ë¡œ ë¬¸ì œ í•´ê²°'
description: 'í¸ì˜ì„± ì¸¡ë©´ì—ì„œ í•´ê²°í•˜ê¸°'
tags:
  - blog
  - path
date: 2024-11-24
---

ë¸”ë¡œê·¸ë¥¼ [ë§ˆì´ê·¸ë ˆì´ì…˜](https://dohyeon.dev/build-nextjs-blog-with-yak-shaving)í•˜ë©´ì„œ ëª‡ ê°€ì§€ ë¬¸ì œë¥¼ ê²ªì—ˆëŠ”ë° ëŒ€ë¶€ë¶„ Gatsby í”ŒëŸ¬ê·¸ì¸ì´ ìë™ìœ¼ë¡œ í•´ì£¼ë˜ ê¸°ëŠ¥ì´ ì‚¬ë¼ì ¸ì„œ ìƒê¸´ ê²ƒë“¤ì´ì—ˆìŠµë‹ˆë‹¤.

ì´ ê¸€ì—ì„œëŠ” Next.jsì—ì„œ MDXë¥¼ ì‚¬ìš©í•  ë•Œ ìƒê¸°ëŠ” ì´ë¯¸ì§€ ì ˆëŒ€ ê²½ë¡œ ë¬¸ì œë¥¼ ì–´ë–¤ ì‹ìœ¼ë¡œ í•´ê²°í–ˆëŠ”ì§€ ë‚¨ê²¨ë³´ê² ìŠµë‹ˆë‹¤.

## í¬ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

ì œ ë¸”ë¡œê·¸ì˜ í¬ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ì´ MDXì™€ MDXì—ì„œ ì‚¬ìš©í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ í•œê³³ì— ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.

```
.
â””â”€â”€ contents
    â””â”€â”€ handle-nextjs-mdx-image-path
        â”œâ”€â”€ 0.png
        â”œâ”€â”€ 1.png
        â”œâ”€â”€ 2.png
        â””â”€â”€ index.mdx
```

ì´ëŸ° êµ¬ì¡°ë¥¼ ì‚¬ìš©í–ˆë˜ ì´ìœ ëŠ” MDXì—ì„œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ `![](0.png)`ì™€ ê°™ì´ ìƒëŒ€ ê²½ë¡œë¡œ ì†ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ê¸°ì¡´ì—ëŠ” ë¬¸ì œê°€ ì—†ì—ˆëŠ”ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ì´í›„ì— ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

Next.jsì˜ `Image`ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ê²°ë˜ëŠ” ê±¸ë¡œ ì•Œê³  ìˆì§€ë§Œ í¸ì˜ì„±ì´ ë–¨ì–´ì§„ë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ì„œ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ìœ ì§€í•˜ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.

## ì´ë¯¸ì§€ë¥¼ ë¶€ë¥´ì§€ ëª»í•˜ëŠ” ì´ìœ 

![](0.png 'ë°”ë¡œ ì˜†ì— ìˆëŠ”ë°ìš”?')

ìš”ì²­ URLì„ ìì„¸íˆ ë³´ë‹ˆ `(root)/0.png`ì™€ ê°™ì´ ì ˆëŒ€ ê²½ë¡œë¡œ ì´ë¯¸ì§€ë¥¼ ìš”ì²­í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ìƒëŒ€ ê²½ë¡œë¡œ ì²˜ë¦¬ë˜ê¸¸ ë°”ëë˜ ê²ƒê³¼ ë‹¬ë¦¬ Next.jsëŠ” í•­ìƒ ì ˆëŒ€ ê²½ë¡œë¡œ `public` ë””ë ‰í† ë¦¬ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì°¾ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¼ ë‹¨ìˆœí•˜ê²Œ ì•„ë˜ì™€ ê°™ì´ `public` ë””ë ‰í† ë¦¬ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê´€ë¦¬í•˜ë©´ ëê² ì§€ë§Œ ê·¸ëŸ¬ê³  ì‹¶ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ì‚½ì… í•  ë•Œë§ˆë‹¤ ë””ë ‰í† ë¦¬ë¥¼ ì˜®ê²¨ë‹¤ë‹ˆëŠ” í”¼ê³¤í•œ ê³¼ì •ì„ ê±°ì³ì•¼í–ˆê³ , `![](/handle-nextjs-mdx-image-path/0.png)`ì²˜ëŸ¼ ê¸´ ì´ë¯¸ì§€ ì£¼ì†Œë¥¼ ì‘ì„±í•´ì•¼í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```
.
â”œâ”€â”€ contents
â”‚   â””â”€â”€ handle-nextjs-mdx-image-path
â”‚       â””â”€â”€ index.mdx
â””â”€â”€ public
    â””â”€â”€ handle-nextjs-mdx-image-path
        â”œâ”€â”€ 0.png
        â”œâ”€â”€ 1.png
        â””â”€â”€ 2.png
```

ê·¸ë˜ì„œ ë°©ë²•ì„ ì°¾ë˜ ì¤‘ ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ ê³ ë¯¼í•œ [ë¸”ë¡œê·¸](https://witch.work/posts/blog-remake-4)ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. Next.jsë¥¼ ì‹¤í–‰í•  ë•Œ ì´ë¯¸ì§€ë“¤ì„ `public` ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•œë‹¤ëŠ” ì•„ì´ë””ì–´ê°€ ì í˜€ìˆì—ˆìŠµë‹ˆë‹¤.

ì¢‹ì€ ì•„ì´ë””ì–´ë¥¼ ì–»ì–´ì„œ ì œ ë¸”ë¡œê·¸ì— ë§ê²Œ êµ¬í˜„í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

## ì´ë¯¸ì§€ ë³µì‚¬í•˜ê¸°

ì´ ë¶€ë¶„ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ì´ë¯¸ì§€ë“¤ì„ `public` ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•˜ëŠ” ë‹¨ìˆœí•œ ìŠ¤í¬ë¦½íŠ¸ì¸ë° ë‹¨ìˆœíˆ `public` ì•ˆì— ë³µì‚¬í•˜ë©´ ëª¨ë“  ì´ë¯¸ì§€ ì´ë¦„ì„ ë‹¤ë¥´ê²Œ ì§€ì–´ì•¼í•˜ê¸° ë•Œë¬¸ì— `public/images/[í¬ìŠ¤íŠ¸ URL]` ì•ˆì— ë³µì‚¬ë˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```js pre-script.mjs
import { access, constants, copyFile, mkdir, readdir, rm } from 'fs/promises';
import path from 'path';

const SOURCE_DIR = path.join(process.cwd(), 'contents');
const TARGET_DIR = path.join(process.cwd(), 'public/images');

const exists = async (path) => {
  try {
    await access(path, constants.F_OK);
    return true;
  } catch {
    return false;
  }
};

const copyImages = async () => {
  const entries = await readdir(SOURCE_DIR, { withFileTypes: true });
  const dirs = entries.filter((entry) => entry.isDirectory()).map((entry) => entry.name);

  if (await exists(TARGET_DIR)) await rm(TARGET_DIR, { recursive: true });

  for await (const dir of dirs) {
    const sourceDirPath = path.resolve(path.join(SOURCE_DIR, dir));
    const targetDirPath = path.resolve(path.join(TARGET_DIR, dir));
    const entries = await readdir(sourceDirPath, { withFileTypes: true });
    const files = entries.filter((entry) => !entry.isDirectory()).map((entry) => entry.name);
    // !mark
    const imageFiles = files.filter((file) => /.(png|gif)$/.test(file));

    if (imageFiles.length === 0) continue;

    await mkdir(targetDirPath, { recursive: true });

    await Promise.all(
      imageFiles.map((imageFile) => {
        // !mark(1:2)
        const sourceFilePath = path.resolve(path.join(sourceDirPath, imageFile));
        const targetFilePath = path.resolve(path.join(targetDirPath, imageFile));

        // !mark
        copyFile(sourceFilePath, targetFilePath);
      })
    );
  }
};

await copyImages();
```

ì‘ì„±í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•´ë³´ë©´ `public` ë””ë ‰í† ë¦¬ ì•ˆì— ì´ë¯¸ì§€ë“¤ì´ ì˜ ë³µì‚¬ëœ ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](1.png 'ì˜ ë³µì‚¬ëœ ì´ë¯¸ì§€ë“¤')

ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§¤ë²ˆ ì‹¤í–‰í•˜ê¸° ê·€ì°®ê¸° ë•Œë¬¸ì— `package.json`ì„ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.

```json package.json
"scripts": {
  "prebuild": "node ./scripts/pre-script.mjs",
  "build": "next build",
  "predev": "node ./scripts/pre-script.mjs",
  "dev": "next dev",
}
```

## ê²½ë¡œ ê°œì„ í•˜ê¸°

ê·¸ëŸ°ë° `public/images/[í¬ìŠ¤íŠ¸ URL]` ì•ˆì— ë³µì‚¬í–ˆê¸° ë•Œë¬¸ì— MDXì—ì„œ `![](images/[í¬ìŠ¤íŠ¸ URL]/0.png)`ì™€ ê°™ì´ ì‘ì„±í•´ì•¼ë˜ëŠ” ë¶ˆí¸í•¨ì€ ì—¬ì „íˆ ìˆì—ˆìŠµë‹ˆë‹¤. `![](0.png)`ê³¼ ê°™ì´ ê°™ì€ ë””ë ‰í† ë¦¬ì— ìˆëŠ” ì´ë¯¸ì§€ ì´ë¦„ë§Œ ì…ë ¥í•´ë„ ì•Œì•„ì„œ ì˜ ì°¾ì•„ì£¼ë©´ ì–¼ë§ˆë‚˜ ì¢‹ì„ê¹Œìš”.

ê°„ë‹¨í•œ `remark` í”ŒëŸ¬ê·¸ì¸ì„ ë§Œë“¤ì–´ì„œ ë¹Œë“œ ë‹¨ê³„ì—ì„œ `img`ì˜ `src`ë¥¼ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤. [unist-util-visit](https://github.com/syntax-tree/unist-util-visit)ì„ ì´ìš©í•˜ë©´ AST íŠ¸ë¦¬ì—ì„œ íŠ¹ì • íƒ€ì…ì˜ ë…¸ë“œë¥¼ íƒìƒ‰í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ìˆ˜ì •í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— `image` ë…¸ë“œë¥¼ íƒìƒ‰í•´ì„œ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

```js remark-public-image.mjs
import { visit } from 'unist-util-visit';

const remarkPublicImage = () => {
  return (tree, file) => {
    // file.history => [(root)/[í¬ìŠ¤íŠ¸ URL]/index.mdx]
    const path = file.history.at(0).split('/').at(-2);

    visit(tree, 'image', (node) => {
      // !mark
      node.url = `/images/${path}/${node.url}`;
    });
  };
};
```

ë§Œë“  í”ŒëŸ¬ê·¸ì¸ì€ `next.config.mjs`ì— ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```js next.config.mjs
import remarkPublicImage from './scripts/remark-public-image.mjs';

const withMDX = createMDX({
  options: {
    ...
    remarkPlugins: [remarkPublicImage],
  },
});

export default withMDX(nextConfig);
```

<Callout>

MDX ë¬¸ë²•ìœ¼ë¡œ ì‘ì„±ë§Œ í–ˆëŠ”ë° ì–´ë–»ê²Œ ë¸Œë¼ìš°ì €ì— ë Œë”ë§ ë˜ëŠ”ê±¸ê¹Œìš”?

ì œ ë¸”ë¡œê·¸ì˜ ê²½ìš° `@mdx-js/mdx`ê°€ ì¤‘ê°„ì—ì„œ ë³€í™˜í•´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.

ê°„ëµí•˜ê²Œ MDX -> MDAST(Markdown Abstract Syntax Tree) -> HAST(HTML Abstract Syntax Tree) -> JSX ìˆœìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.

í”ŒëŸ¬ê·¸ì¸ë“¤ì€ ì´ëŸ° ë³€í™˜ ê³¼ì •ì— ê°œì…í•´ì„œ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¥¼ ì¡°ì‘ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œê°€ í”ŒëŸ¬ê·¸ì¸ì„ ë§Œë“¤ë©´ì„œ `unist-util-visit`ì„ í†µí•´ `src`ë¥¼ ìˆ˜ì • í•  ìˆ˜ ìˆì—ˆë˜ ì´ìœ ì…ë‹ˆë‹¤.

</Callout>

ì´ì œ ë§ˆë¬´ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì‹¤í–‰ ì‹œ `public` ë””ë ‰í† ë¦¬ì— ì´ë¯¸ì§€ë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì›ê²© ì €ì¥ì†Œì— ì˜¬ë¦´ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. `.gitignore`ì—ë„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```json .gitignore
# asset
/public/images/*
```

ì´ì œ MDXì™€ ì´ë¯¸ì§€ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ê³ , ê²½ë¡œë„ ê°„ë‹¨í•˜ê²Œ ì ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
